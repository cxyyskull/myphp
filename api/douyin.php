{"payload":{"allShortcutsEnabled":true,"fileTree":{"PHP":{"items":[{"name":"README.md","path":"PHP/README.md","contentType":"file"},{"name":"allinone.php","path":"PHP/allinone.php","contentType":"file"},{"name":"bestv.php","path":"PHP/bestv.php","contentType":"file"},{"name":"cqyx.php","path":"PHP/cqyx.php","contentType":"file"},{"name":"douyin.php","path":"PHP/douyin.php","contentType":"file"},{"name":"gdtv.php","path":"PHP/gdtv.php","contentType":"file"},{"name":"ghyx.php","path":"PHP/ghyx.php","contentType":"file"},{"name":"gudou.php","path":"PHP/gudou.php","contentType":"file"},{"name":"itouch.php","path":"PHP/itouch.php","contentType":"file"},{"name":"sencond-xxtv4k.php","path":"PHP/sencond-xxtv4k.php","contentType":"file"},{"name":"sxg.php","path":"PHP/sxg.php","contentType":"file"},{"name":"tvb.php","path":"PHP/tvb.php","contentType":"file"},{"name":"xxtv4k.php","path":"PHP/xxtv4k.php","contentType":"file"}],"totalCount":13},"":{"items":[{"name":".github","path":".github","contentType":"directory"},{"name":".idea","path":".idea","contentType":"directory"},{"name":"Golang","path":"Golang","contentType":"directory"},{"name":"PHP","path":"PHP","contentType":"directory"},{"name":"logo","path":"logo","contentType":"directory"},{"name":"main","path":"main","contentType":"directory"},{"name":"Dockerfile","path":"Dockerfile","contentType":"file"},{"name":"LICENSE","path":"LICENSE","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"}],"totalCount":9}},"fileTreeProcessingTime":5.534054,"foldersToFetch":[],"reducedMotionEnabled":"system","repo":{"id":582059828,"defaultBranch":"main","name":"LiveRedirect","ownerLogin":"youshandefeiyang","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2022-12-25T21:59:21.000+08:00","ownerAvatar":"https://avatars.githubusercontent.com/u/63959400?v=4","public":true,"private":false},"refInfo":{"name":"main","listCacheKey":"v0:1683386422.0","canEdit":true,"refType":"branch","currentOid":"55d4641a5731c42c449dd98ff23cf2807776159c"},"path":"PHP/douyin.php","currentUser":{"id":96327842,"login":"cxyyskull","userEmail":"cxyyhhzx119@gmail.com"},"blob":{"rawBlob":"<?php\n\n$liveid = $_GET['rid'] ?? null;\nfunction mk_dir($newdir)\n{\n    $dir = $newdir;\n    if (is_dir('./' . $dir)) {\n        return $dir;\n    } else {\n        mkdir('./' . $dir, 0777, true);\n        return $dir;\n    }\n}\n$liveurl = \"https://live.douyin.com/$liveid\";\n$cookietext = './' . mk_dir('cookies/') . md5(microtime()) . '.' . 'txt';\n$headers = array(\n    'upgrade-insecure-requests: 1',\n    'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36'\n);\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $liveurl);\ncurl_setopt($ch, CURLOPT_HTTPHEADER, $headers);\ncurl_setopt($ch, CURLOPT_HEADER, TRUE);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);\ncurl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE);\ncurl_setopt($ch, CURLOPT_COOKIEJAR, $cookietext);\n$mcontent = curl_exec($ch);\ncurl_close($ch);\npreg_match('/Set-Cookie:(.*);/iU', $mcontent, $str);\n$realstr = $str[1];\n$newheader = array(\n    \"cookie:$realstr\",\n    'upgrade-insecure-requests: 1',\n    'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36'\n);\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $liveurl);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);\ncurl_setopt($ch, CURLOPT_HTTPHEADER, $newheader);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);\n$data = curl_exec($ch);\ncurl_close($ch);\n$realdata = urldecode($data);\nunlink($cookietext);\n$reg = \"/\\\"roomid\\\"\\:\\\"([0-9]+)\\\"/i\";\npreg_match($reg, $realdata, $roomid);\n$nnreg = \"/\\\"id_str\\\":\\\"{$roomid[1]}\\\"[\\s\\S]*?\\\"hls_pull_url\\\"/i\";\npreg_match($nnreg,$realdata,$newcontent);\n$nnnreg = \"/\\\"hls_pull_url_map\\\"[\\s\\S]*?}/i\";\npreg_match($nnnreg,$newcontent[0],$finalstr);\n$mediaArr = json_decode('{' . $finalstr[0] . '}',true);\n$hls_url = $mediaArr['hls_pull_url_map']['FULL_HD1'];\nheader('location:' . $hls_url);\n","colorizedLines":["<span class=pl-ent>&lt;?php</span>","","<span class=pl-s1><span class=pl-c1>$</span>liveid</span> = <span class=pl-s1><span class=pl-c1>$</span><span class=pl-c1>_GET</span></span>[<span class=pl-s>&#39;rid&#39;</span>] ?? <span class=pl-c1>null</span>;","<span class=pl-k>function</span> <span class=pl-en>mk_dir</span>(<span class=pl-s1><span class=pl-c1>$</span>newdir</span>)","{","    <span class=pl-s1><span class=pl-c1>$</span>dir</span> = <span class=pl-s1><span class=pl-c1>$</span>newdir</span>;","    <span class=pl-k>if</span> (is_dir(<span class=pl-s>&#39;./&#39;</span> . <span class=pl-s1><span class=pl-c1>$</span>dir</span>)) {","        <span class=pl-k>return</span> <span class=pl-s1><span class=pl-c1>$</span>dir</span>;","    } <span class=pl-k>else</span> {","        mkdir(<span class=pl-s>&#39;./&#39;</span> . <span class=pl-s1><span class=pl-c1>$</span>dir</span>, <span class=pl-c1>0777</span>, <span class=pl-c1>true</span>);","        <span class=pl-k>return</span> <span class=pl-s1><span class=pl-c1>$</span>dir</span>;","    }","}","<span class=pl-s1><span class=pl-c1>$</span>liveurl</span> = &quot;<span class=pl-s>https://live.douyin.com/</span><span class=pl-s1><span class=pl-c1>$</span>liveid</span>&quot;;","<span class=pl-s1><span class=pl-c1>$</span>cookietext</span> = <span class=pl-s>&#39;./&#39;</span> . mk_dir(<span class=pl-s>&#39;cookies/&#39;</span>) . md5(microtime()) . <span class=pl-s>&#39;.&#39;</span> . <span class=pl-s>&#39;txt&#39;</span>;","<span class=pl-s1><span class=pl-c1>$</span>headers</span> = <span class=pl-en>array</span>(","    <span class=pl-s>&#39;upgrade-insecure-requests: 1&#39;</span>,","    <span class=pl-s>&#39;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&#39;</span>",");","<span class=pl-s1><span class=pl-c1>$</span>ch</span> = curl_init();","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_URL</span>, <span class=pl-s1><span class=pl-c1>$</span>liveurl</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_HTTPHEADER</span>, <span class=pl-s1><span class=pl-c1>$</span>headers</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_HEADER</span>, <span class=pl-c1>TRUE</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_RETURNTRANSFER</span>, <span class=pl-c1>TRUE</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_FOLLOWLOCATION</span>, <span class=pl-c1>TRUE</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_COOKIEJAR</span>, <span class=pl-s1><span class=pl-c1>$</span>cookietext</span>);","<span class=pl-s1><span class=pl-c1>$</span>mcontent</span> = curl_exec(<span class=pl-s1><span class=pl-c1>$</span>ch</span>);","curl_close(<span class=pl-s1><span class=pl-c1>$</span>ch</span>);","preg_match(<span class=pl-s>&#39;/Set-Cookie:(.*);/iU&#39;</span>, <span class=pl-s1><span class=pl-c1>$</span>mcontent</span>, <span class=pl-s1><span class=pl-c1>$</span>str</span>);","<span class=pl-s1><span class=pl-c1>$</span>realstr</span> = <span class=pl-s1><span class=pl-c1>$</span>str</span>[<span class=pl-c1>1</span>];","<span class=pl-s1><span class=pl-c1>$</span>newheader</span> = <span class=pl-en>array</span>(","    &quot;<span class=pl-s>cookie:</span><span class=pl-s1><span class=pl-c1>$</span>realstr</span>&quot;,","    <span class=pl-s>&#39;upgrade-insecure-requests: 1&#39;</span>,","    <span class=pl-s>&#39;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&#39;</span>",");","<span class=pl-s1><span class=pl-c1>$</span>ch</span> = curl_init();","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_URL</span>, <span class=pl-s1><span class=pl-c1>$</span>liveurl</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_RETURNTRANSFER</span>, <span class=pl-c1>TRUE</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_HTTPHEADER</span>, <span class=pl-s1><span class=pl-c1>$</span>newheader</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_SSL_VERIFYPEER</span>, <span class=pl-c1>FALSE</span>);","curl_setopt(<span class=pl-s1><span class=pl-c1>$</span>ch</span>, <span class=pl-c1>CURLOPT_SSL_VERIFYHOST</span>, <span class=pl-c1>FALSE</span>);","<span class=pl-s1><span class=pl-c1>$</span>data</span> = curl_exec(<span class=pl-s1><span class=pl-c1>$</span>ch</span>);","curl_close(<span class=pl-s1><span class=pl-c1>$</span>ch</span>);","<span class=pl-s1><span class=pl-c1>$</span>realdata</span> = urldecode(<span class=pl-s1><span class=pl-c1>$</span>data</span>);","unlink(<span class=pl-s1><span class=pl-c1>$</span>cookietext</span>);","<span class=pl-s1><span class=pl-c1>$</span>reg</span> = &quot;<span class=pl-s>/</span>\\&quot;<span class=pl-s>roomid</span>\\&quot;<span class=pl-s>\\:</span>\\&quot;<span class=pl-s>([0-9]+)</span>\\&quot;<span class=pl-s>/i</span>&quot;;","preg_match(<span class=pl-s1><span class=pl-c1>$</span>reg</span>, <span class=pl-s1><span class=pl-c1>$</span>realdata</span>, <span class=pl-s1><span class=pl-c1>$</span>roomid</span>);","<span class=pl-s1><span class=pl-c1>$</span>nnreg</span> = &quot;<span class=pl-s>/</span>\\&quot;<span class=pl-s>id_str</span>\\&quot;<span class=pl-s>:</span>\\&quot;{<span class=pl-s1><span class=pl-c1>$</span>roomid</span>[<span class=pl-c1>1</span>]}\\&quot;<span class=pl-s>[\\s\\S]*?</span>\\&quot;<span class=pl-s>hls_pull_url</span>\\&quot;<span class=pl-s>/i</span>&quot;;","preg_match(<span class=pl-s1><span class=pl-c1>$</span>nnreg</span>,<span class=pl-s1><span class=pl-c1>$</span>realdata</span>,<span class=pl-s1><span class=pl-c1>$</span>newcontent</span>);","<span class=pl-s1><span class=pl-c1>$</span>nnnreg</span> = &quot;<span class=pl-s>/</span>\\&quot;<span class=pl-s>hls_pull_url_map</span>\\&quot;<span class=pl-s>[\\s\\S]*?}/i</span>&quot;;","preg_match(<span class=pl-s1><span class=pl-c1>$</span>nnnreg</span>,<span class=pl-s1><span class=pl-c1>$</span>newcontent</span>[<span class=pl-c1>0</span>],<span class=pl-s1><span class=pl-c1>$</span>finalstr</span>);","<span class=pl-s1><span class=pl-c1>$</span>mediaArr</span> = json_decode(<span class=pl-s>&#39;{&#39;</span> . <span class=pl-s1><span class=pl-c1>$</span>finalstr</span>[<span class=pl-c1>0</span>] . <span class=pl-s>&#39;}&#39;</span>,<span class=pl-c1>true</span>);","<span class=pl-s1><span class=pl-c1>$</span>hls_url</span> = <span class=pl-s1><span class=pl-c1>$</span>mediaArr</span>[<span class=pl-s>&#39;hls_pull_url_map&#39;</span>][<span class=pl-s>&#39;FULL_HD1&#39;</span>];","header(<span class=pl-s>&#39;location:&#39;</span> . <span class=pl-s1><span class=pl-c1>$</span>hls_url</span>);"],"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/youshandefeiyang/LiveRedirect/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":false,"repoAlertsPath":"/youshandefeiyang/LiveRedirect/security/dependabot","repoSecurityAndAnalysisPath":"/youshandefeiyang/LiveRedirect/settings/security_analysis","repoOwnerIsOrg":false,"currentUserCanAdminRepo":false},"displayName":"douyin.php","displayUrl":"https://github.com/youshandefeiyang/LiveRedirect/blob/main/PHP/douyin.php?raw=true","headerInfo":{"blobSize":"1.88 KB","deleteInfo":{"deletePath":"https://github.com/youshandefeiyang/LiveRedirect/delete/main/PHP/douyin.php","deleteTooltip":"Delete the file in your fork of this project"},"editInfo":{"editTooltip":"Edit the file in your fork of this project"},"ghDesktopPath":"x-github-client://openRepo/https://github.com/youshandefeiyang/LiveRedirect?branch=main&filepath=PHP%2Fdouyin.php","gitLfsPath":null,"onBranch":true,"shortPath":"9d2f31b","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Fyoushandefeiyang%2FLiveRedirect%2Fblob%2Fmain%2FPHP%2Fdouyin.php","isCSV":false,"isRichtext":false,"toc":null,"lineInfo":{"truncatedLoc":"54","truncatedSloc":"53"},"mode":"file"},"image":false,"isCodeownersFile":null,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"PHP","large":false,"loggedIn":true,"newDiscussionPath":"/youshandefeiyang/LiveRedirect/discussions/new","newIssuePath":"/youshandefeiyang/LiveRedirect/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/youshandefeiyang/LiveRedirect/blob/main/PHP/douyin.php","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/youshandefeiyang/LiveRedirect/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"renderImageOrRaw":false,"richText":null,"renderedFileInfo":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"youshandefeiyang","repoName":"LiveRedirect","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":false,"symbols":[{"name":"mk_dir","kind":"function","identStart":48,"identEnd":54,"extentStart":39,"extentEnd":219,"fullyQualifiedName":"mk_dir","identUtf16":{"start":{"lineNumber":3,"utf16Col":9},"end":{"lineNumber":3,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":3,"utf16Col":0},"end":{"lineNumber":12,"utf16Col":1}}}]}},"csrf_tokens":{"/youshandefeiyang/LiveRedirect/branches":{"post":"QjbJ-4glcxoRk_Vu-FhcJU_q-U881Bdi7Tx23P8jeLGYL0rplAILGAf5HJh7rPajUQFthtzrh-9V7mmpAN1usQ"}}},"title":"LiveRedirect/douyin.php at main · youshandefeiyang/LiveRedirect","locale":"en"}